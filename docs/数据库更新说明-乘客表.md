# æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬æ›´æ–°è¯´æ˜

> **é¡¹ç›®æ ¹ç›®å½•**: `SEUAirline/`

## ğŸ“¢ é‡è¦æ›´æ–°ï¼ˆ2025-11-12ï¼‰

### âœ¨ æ”¹è¿›å†…å®¹

**ä¹˜å®¢ä¿¡æ¯è¡¨ï¼ˆpassengersï¼‰å·²æ•´åˆåˆ°ä¸»åˆå§‹åŒ–è„šæœ¬ï¼**

- âœ… **æ— éœ€é¢å¤–è„šæœ¬**ï¼šæ‰€æœ‰è¡¨ç»“æ„ï¼ˆåŒ…æ‹¬ `passengers` è¡¨ï¼‰éƒ½åœ¨ `init-database.sql` ä¸­
- âœ… **ä¸€é”®åˆå§‹åŒ–**ï¼šåªéœ€è¿è¡Œä¸€ä¸ªè„šæœ¬å³å¯å®Œæˆæ‰€æœ‰æ•°æ®åº“é…ç½®
- âœ… **æµ‹è¯•æ•°æ®é½å…¨**ï¼šå·²ä¸ºæµ‹è¯•ç”¨æˆ· `passenger1` å’Œ `passenger2` æ·»åŠ å¸¸ç”¨ä¹˜å®¢

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šé‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼ˆæ¨èï¼‰

å¦‚æœä½ çš„æ•°æ®åº“æ˜¯æµ‹è¯•æ•°æ®ï¼Œå¯ä»¥ç›´æ¥é‡æ–°åˆå§‹åŒ–ï¼š

```powershell
# å¯¼èˆªåˆ°è„šæœ¬ç›®å½•
cd seu-airline-backend/src/main/resources

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
Get-Content init-database.sql | mysql -u root -p seu_airline
```

### æ–¹æ³•äºŒï¼šä»…æ·»åŠ ä¹˜å®¢è¡¨ï¼ˆå·²æœ‰é‡è¦æ•°æ®ï¼‰

å¦‚æœä½ å·²ç»æœ‰é‡è¦çš„è®¢å•æˆ–å…¶ä»–æ•°æ®ï¼Œå¯ä»¥åªæ‰§è¡Œä¹˜å®¢è¡¨ç›¸å…³çš„ SQLï¼š

```sql
-- 1. åˆ›å»ºä¹˜å®¢ä¿¡æ¯è¡¨
CREATE TABLE IF NOT EXISTS passengers (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    passenger_name VARCHAR(100) NOT NULL,
    id_type VARCHAR(20) NOT NULL DEFAULT 'ID_CARD',
    id_card VARCHAR(50) NOT NULL,
    phone VARCHAR(20),
    email VARCHAR(100),
    passenger_type VARCHAR(20) NOT NULL DEFAULT 'ADULT',
    is_default BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_id_card (id_card),
    INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 2. ä¿®æ”¹è®¢å•æ˜ç»†è¡¨ï¼ˆæ·»åŠ ä¹˜å®¢å…³è”ï¼‰
ALTER TABLE order_items 
ADD COLUMN passenger_type VARCHAR(20) COMMENT 'ä¹˜å®¢ç±»å‹ï¼ˆADULT-æˆäºº/CHILD-å„¿ç«¥/INFANT-å©´å„¿ï¼‰' AFTER passenger_id_card,
ADD COLUMN passenger_id BIGINT COMMENT 'å…³è”çš„ä¹˜å®¢IDï¼ˆå¯é€‰ï¼‰' AFTER passenger_type,
ADD FOREIGN KEY (passenger_id) REFERENCES passengers(id) ON DELETE SET NULL,
ADD INDEX idx_passenger_id (passenger_id);

-- 3. æ’å…¥æµ‹è¯•ä¹˜å®¢æ•°æ®
INSERT INTO passengers (user_id, passenger_name, id_type, id_card, phone, email, passenger_type, is_default)
VALUES
    (2, 'å¼ ä¸‰', 'ID_CARD', '320106199001011234', '13800138000', 'zhangsan@example.com', 'ADULT', TRUE),
    (2, 'æå››', 'ID_CARD', '320106199502021234', '13900139000', 'lisi@example.com', 'ADULT', FALSE),
    (2, 'ç‹å°æ˜', 'ID_CARD', '320106201501011234', '13700137000', NULL, 'CHILD', FALSE),
    (3, 'èµµå…­', 'PASSPORT', 'E12345678', '13600136000', 'zhaoliu@example.com', 'ADULT', TRUE),
    (3, 'å­™ä¸ƒ', 'ID_CARD', '320106199203031234', '13500135000', 'sunqi@example.com', 'ADULT', FALSE);
```

---

## ğŸ“Š æ–°å¢çš„è¡¨ç»“æ„

### passengers è¡¨ï¼ˆä¹˜å®¢ä¿¡æ¯è¡¨ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `id` | BIGINT | ä¸»é”®ID |
| `user_id` | BIGINT | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| `passenger_name` | VARCHAR(100) | ä¹˜å®¢å§“å |
| `id_type` | VARCHAR(20) | è¯ä»¶ç±»å‹ |
| `id_card` | VARCHAR(50) | è¯ä»¶å·ç  |
| `phone` | VARCHAR(20) | è”ç³»ç”µè¯ |
| `email` | VARCHAR(100) | é‚®ç®±åœ°å€ |
| `passenger_type` | VARCHAR(20) | ä¹˜å®¢ç±»å‹ |
| `is_default` | BOOLEAN | æ˜¯å¦é»˜è®¤ |
| `created_at` | DATETIME | åˆ›å»ºæ—¶é—´ |
| `updated_at` | DATETIME | æ›´æ–°æ—¶é—´ |

### order_items è¡¨æ–°å¢å­—æ®µ

- `passenger_type` - ä¹˜å®¢ç±»å‹
- `passenger_id` - å…³è”çš„ä¹˜å®¢IDï¼ˆå¤–é”®åˆ° passengers è¡¨ï¼‰

---

## âœ… éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ

```powershell
mysql -u root -p seu_airline -e "SHOW TABLES LIKE 'passengers';"
```

### 2. æŸ¥çœ‹è¡¨ç»“æ„

```powershell
mysql -u root -p seu_airline -e "DESCRIBE passengers;"
```

### 3. æŸ¥çœ‹æµ‹è¯•æ•°æ®

```powershell
mysql -u root -p seu_airline -e "SELECT * FROM passengers;"
```

åº”è¯¥çœ‹åˆ° 5 æ¡ä¹˜å®¢è®°å½•ï¼ˆ3 æ¡å±äº user_id=2ï¼Œ2 æ¡å±äº user_id=3ï¼‰

---

## ğŸ¯ æµ‹è¯•è´¦å·

ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•è´¦å·ç™»å½•åç«¯ APIï¼š

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | å¸¸ç”¨ä¹˜å®¢æ•°é‡ |
|--------|------|------|-------------|
| `passenger1` | `password` | PASSENGER | 3 äºº |
| `passenger2` | `password` | PASSENGER | 2 äºº |

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- **åç«¯å®ç°è¯´æ˜**ï¼š`seu-airline-backend/docs/å¸¸ç”¨ä¹˜å®¢åŠŸèƒ½-åç«¯å®ç°è¯´æ˜.md`
- **æ•°æ®åº“è„šæœ¬**ï¼š`seu-airline-backend/src/main/resources/init-database.sql`

---

**æœ€åæ›´æ–°ï¼š** 2025å¹´11æœˆ12æ—¥
